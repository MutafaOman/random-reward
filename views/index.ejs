<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel='stylesheet' href='/stylesheets/style.css' />
  <title>TEST REWARD</title>
</head>
<main>
  <div class="container pt-5">
    <div class="row">
      <div class="col-6">
        <div class="mb-3">
          <div class="form-group">
            <label>No. Index</label>
            <input type="text" class="form-control form-control-sm mb-2" id="reward" disabled readonly />
          </div>
          <div class="form-group">
            <label>Username</label>
            <input type="text" class="form-control form-control-sm mb-2" id="username" disabled readonly />
          </div>
          <div class="form-group">
            <label>TranferIn</label>
            <input type="text" class="form-control form-control-sm mb-2" id="tranferIn" disabled readonly />
          </div>
          <div class="form-group">
            <label>TurnOver</label>
            <input type="text" class="form-control form-control-sm" id="turnOver" disabled readonly />
          </div>
        </div>
      </div>
      <div class="col-6">
        <form id="random" action="#" method="POST">
          <div class="mb-3">
            <div class="text-center">
              <label>Setting Random</label>
            </div>
            <div class="form-group">
              <label>Type Number</label>
              <div>
                <div class="form-check-inline">
                  <label class="form-check-label" for="radio1">
                    <input type="radio" class="form-check-input" id="radio1" name="type" value="all" checked>All
                  </label>
                </div>
                <div class="form-check-inline">
                  <label class="form-check-label" for="radio2">
                    <input type="radio" class="form-check-input" id="radio2" name="type" value="even">Even Number
                  </label>
                </div>
                <div class="form-check-inline">
                  <label class="form-check-label" for="radio3">
                    <input type="radio" class="form-check-input" id="radio3" name="type" value="odd">Odd Number
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <div class="form-group">
              <label>TranferIn</label>
              <input type="number" class="form-control form-contro-sm" id="tranferIn" name="tranferIn" />
            </div>
          </div>
          <div class="form-group">
            <label>TurnOver</label>
            <input type="number" class="form-control form-contro-sm" id="turnover" name="turnover" />
          </div>
          <div class="form-group">
            <label>Max Number</label>
            <input type="number" class="form-control form-contro-sm" id="max" name="max" />
          </div>
          <div class="text-center">
            <button class="btn btn-sm btn-primary" type="submit">Random</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>

<body>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
  <script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.min.js"></script>
  <script type="text/javascript" src="../json/user.json"></script>
  <script>
    var User = []
    loadJSON()
    function loadJSON() {
      var xobj = new XMLHttpRequest();
      xobj.overrideMimeType("application/json");
      xobj.open('GET', '../json/user.json', true);
      xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
          User = xobj.responseText
          User = JSON.parse(User)
        }
      };
      xobj.send(null);
    }

    $('#random').validate({
      errorClass: 'is-invalid',
      rules: {
        'max': {
          required: !0,
        },
        'tranferIn': {
          required: !0,
        },
        'turnover': {
          required: !0,
        }
      },
      messages: {
        'max': {
          required: 'Enter Max',
        },
        'tranferIn': {
          required: 'Enter tranferIn min',
        },
        'turnover': {
          required: 'Enter turnover min',
        }
      },
      submitHandler: function (form) {
        randomIntFromInterval()
      }
    });

    function UserInValidate() {
      const tranferInMin = $('#tranferIn').val()
      const turnOverMin = $('#turnover').val()
      const array = []
      for (let i in User) {
        if (tranferInMin < User[i].tranferIn && tranferInMin < User[i].turnOver) {
          array.push(User[i])
        }
      }
      return { max: array.length, data: array }
    }

    function randomIntFromInterval() {
      const min = 0
      let max = $('#max').val()
      const type = $('input[name="type"]:checked').val()
      const count = UserInValidate()
      max = count.max >= max ? max : count.max
      const index = Math.floor(Math.random() * (max - min + 1) + min)
      const checkType = index % 2 == 0 ? true : false
      if (type == 'all') {
        Draw(index, User[index], count.max)
      } else if (type == 'even') {
        const even = !checkType ? index + 1 > max ? index - 1 : index + 1 : index
        Draw(even, User[even], count.max)
      } else if (type == 'odd') {
        const odd = checkType ? index + 1 > max ? index - 1 : index + 1 : index
        Draw(odd, User[odd], count.max)
      }
    }

    function Draw(index, reward, count) {
      $('#reward').val(index);
      $('#max').val(count);
      $('#username').val(reward.username)
      $('#tranferIn').val(reward.tranferIn)
      $('#turnOver').val(reward.turnOver)
      $('#err-max').text('')
    }
  </script>
</body>

</html>